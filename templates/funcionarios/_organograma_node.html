{% load static %}

<div class="bg-white shadow rounded-lg overflow-hidden mb-4" style="margin-left: {{ level }}rem;">
    <div class="p-4 {% if level == 0 %}bg-gradient-to-r from-purple-500 to-purple-600 text-white{% elif level == 1 %}bg-gradient-to-r from-blue-500 to-blue-600 text-white{% elif level == 2 %}bg-gradient-to-r from-green-500 to-green-600 text-white{% else %}bg-gray-100{% endif %}">
        <div class="flex items-center justify-between">
            <div class="flex items-center flex-1">
                <!-- Foto -->
                <div class="flex-shrink-0">
                    {% if funcionario.foto %}
                        <img class="h-16 w-16 rounded-full object-cover border-4 {% if level == 0 or level == 1 or level == 2 %}border-white{% else %}border-gray-300{% endif %}" src="{{ funcionario.foto.url }}" alt="{{ funcionario.nome_completo }}">
                    {% else %}
                        <div class="h-16 w-16 rounded-full {% if level == 0 or level == 1 or level == 2 %}bg-white text-gray-700{% else %}bg-gray-300 text-gray-600{% endif %} flex items-center justify-center border-4 {% if level == 0 or level == 1 or level == 2 %}border-white{% else %}border-gray-300{% endif %}">
                            <span class="font-bold text-xl">{{ funcionario.nome_completo.0 }}</span>
                        </div>
                    {% endif %}
                </div>
                
                <!-- Informações -->
                <div class="ml-4 flex-1">
                    <div class="flex items-center">
                        <a href="{% url 'funcionarios:detail' funcionario.pk %}" class="text-lg font-bold {% if level == 0 or level == 1 or level == 2 %}text-white hover:underline{% else %}text-gray-900 hover:text-blue-700{% endif %}">
                            {{ funcionario.nome_completo }}
                        </a>
                        {% if level == 0 %}
                            <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                <i data-lucide="crown" class="w-3 h-3 mr-1"></i>
                                Alta Direção
                            </span>
                        {% endif %}
                        {% if funcionario.is_chefe %}
                            <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                                <i data-lucide="briefcase" class="w-3 h-3 mr-1"></i>
                                Chefe: {{ funcionario.setor_chefiado.nome }}
                            </span>
                        {% endif %}
                    </div>
                    <p class="text-sm {% if level == 0 or level == 1 or level == 2 %}text-white opacity-90{% else %}text-gray-600{% endif %} mt-1">
                        {{ funcionario.funcao.nome }} • {{ funcionario.setor.nome }}
                    </p>
                    <p class="text-xs {% if level == 0 or level == 1 or level == 2 %}text-white opacity-75{% else %}text-gray-500{% endif %} mt-1">
                        CPF: {{ funcionario.cpf }} • Admissão: {{ funcionario.data_admissao|date:"d/m/Y" }}
                    </p>
                </div>
            </div>
            
            <!-- Estatísticas -->
            <div class="flex-shrink-0 ml-4">
                {% with subordinados=funcionario.get_subordinados_diretos %}
                    {% if subordinados %}
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-white {% if level == 0 %}text-purple-700{% elif level == 1 %}text-blue-700{% elif level == 2 %}text-green-700{% else %}text-gray-700{% endif %}">
                        <i data-lucide="users" class="w-4 h-4 mr-1"></i>
                        {{ subordinados.count }} Subordinado{{ subordinados.count|pluralize }}
                    </span>
                    {% endif %}
                {% endwith %}
            </div>
        </div>
    </div>
    
    <!-- Barra de Nível -->
    {% if level > 0 %}
    <div class="h-1 {% if level == 1 %}bg-blue-200{% elif level == 2 %}bg-green-200{% elif level == 3 %}bg-yellow-200{% else %}bg-gray-200{% endif %}"></div>
    {% endif %}
</div>

<!-- Subordinados (Recursivo) -->
{% with subordinados=funcionario.get_subordinados_diretos %}
    {% if subordinados %}
    <div class="ml-8 border-l-4 {% if level == 0 %}border-purple-300{% elif level == 1 %}border-blue-300{% elif level == 2 %}border-green-300{% else %}border-gray-300{% endif %} pl-4 space-y-4 mb-4">
        {% for subordinado in subordinados %}
            {% include 'funcionarios/_organograma_node.html' with funcionario=subordinado level=level|add:1 %}
        {% endfor %}
    </div>
    {% endif %}
{% endwith %}
